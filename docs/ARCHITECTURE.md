# ğŸ—ï¸ Ad-Bridge ì•„í‚¤í…ì²˜ ë¬¸ì„œ

**Version:** 1.1  
**Updated:** 2025-12-18

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

Ad-BridgeëŠ” Next.js 16 ê¸°ë°˜ì˜ í’€ìŠ¤íƒ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ, Supabaseë¥¼ ë°±ì—”ë“œë¡œ ì‚¬ìš©í•˜ëŠ” ì„±ê³¼í˜• ì»¤ë¨¸ìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤.

### ê¸°ìˆ  ìŠ¤íƒ

- **Frontend Framework**: Next.js 16 (App Router)
- **UI Library**: React 19
- **Language**: TypeScript
- **Styling**: Tailwind CSS 4
- **State Management**: TanStack Query (React Query)
- **Backend**: Supabase (PostgreSQL + Auth + Storage)
- **Authentication**: Supabase Auth (JWT ê¸°ë°˜)
- **UI Components**: Radix UI + Custom Components

---

## 2. ì•„í‚¤í…ì²˜ íŒ¨í„´

### 2.1 ë°ì´í„° í˜ì¹­ ì „ëµ

**CSR ìš°ì„  ì „ëµ (React Query ì¤‘ì‹¬)**

- **CSR (Client-Side Rendering)**: ëª¨ë“  ë™ì  ë°ì´í„° í˜ì¹­
  - ìº í˜ì¸ íƒìƒ‰ í˜ì´ì§€: ì™„ì „ CSR (í•„í„°ë§, ê²€ìƒ‰)
  - ìº í˜ì¸ ìƒì„¸ í˜ì´ì§€ (í¬ë¦¬ì—ì´í„°ìš©): ì™„ì „ CSR
  - ìº í˜ì¸ ìƒì„¸ í˜ì´ì§€ (ê´‘ê³ ì£¼ìš©): ì™„ì „ CSR
  - ê´‘ê³ ì£¼ ëŒ€ì‹œë³´ë“œ: ì™„ì „ CSR (ìº í˜ì¸ ëª©ë¡, ì§€ì›ì„œ, í†µê³„)
  - í¬ë¦¬ì—ì´í„° ë‚´ ìº í˜ì¸ ëª©ë¡: ì™„ì „ CSR
  - ì‹¤ì‹œê°„ í†µê³„ ì—…ë°ì´íŠ¸: React Query (CSR)
  
- **SSR (Server-Side Rendering)**: ì •ì  ì»¨í…ì¸ ë§Œ
  - ë ˆì´ì•„ì›ƒ (Header, Footer)
  - ì •ì  í…ìŠ¤íŠ¸/ì½˜í…ì¸ 
  - SEOê°€ ì¤‘ìš”í•œ ê³µê°œ í˜ì´ì§€ (ëœë”© í˜ì´ì§€)

**React Query í™œìš©**
- ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë°ì´í„° í˜ì¹­ì€ React Queryë¡œ ê´€ë¦¬
- ìºì‹±, ìë™ ë¦¬í˜ì¹­, ì—ëŸ¬ í•¸ë“¤ë§ í†µí•©
- `staleTime` ì„¤ì •ìœ¼ë¡œ ë¶ˆí•„ìš”í•œ ìš”ì²­ ìµœì†Œí™”

### 2.2 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
components/
â”œâ”€â”€ primitives/          # ì›ìì  UI ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ Badge ê³„ì—´
â”‚   â”œâ”€â”€ ImageWithFallback
â”‚   â””â”€â”€ CategoryText
â”œâ”€â”€ patterns/            # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨í„´ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ CampaignListItem
â”‚   â”œâ”€â”€ LockedValue
â”‚   â””â”€â”€ EmptyState
â”œâ”€â”€ features/           # ê¸°ëŠ¥ë³„ ë„ë©”ì¸ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ campaigns/
â”‚   â””â”€â”€ advertiser/
â””â”€â”€ ui/                  # ê¸°ë³¸ UI ì»´í¬ë„ŒíŠ¸ (Radix ê¸°ë°˜)
```

### 2.3 íƒ€ì… ì‹œìŠ¤í…œ

- **ê³µí†µ íƒ€ì…**: `lib/types/campaign.ts`
  - `Campaign`, `Product`, `ProductCategory` íƒ€ì… ì •ì˜
  - ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì¼ê´€ëœ íƒ€ì… ì‚¬ìš©

- **ì¿¼ë¦¬ í‚¤ ê´€ë¦¬**: `lib/queries/keys.ts`
  - ê³„ì¸µì  êµ¬ì¡°ë¡œ React Query í‚¤ ê´€ë¦¬
  - íƒ€ì… ì•ˆì •ì„± ë³´ì¥

---

## 3. ë¼ìš°íŒ… êµ¬ì¡°

### 3.1 í˜ì´ì§€ ë¼ìš°íŠ¸

```
app/
â”œâ”€â”€ (main)/              # ì¸ì¦ í•„ìš” í˜ì´ì§€ ê·¸ë£¹
â”‚   â”œâ”€â”€ advertiser/
â”‚   â”‚   â”œâ”€â”€ dashboard/          # ê´‘ê³ ì£¼ ëŒ€ì‹œë³´ë“œ (CSR + React Query)
â”‚   â”‚   â””â”€â”€ campaigns/
â”‚   â”‚       â”œâ”€â”€ [id]/           # ìº í˜ì¸ ìƒì„¸ (CSR + React Query)
â”‚   â”‚       â””â”€â”€ new/            # ìº í˜ì¸ ìƒì„± (CSR)
â”‚   â”œâ”€â”€ campaigns/
â”‚   â”‚   â”œâ”€â”€ page.tsx            # ìº í˜ì¸ íƒìƒ‰ (CSR + React Query)
â”‚   â”‚   â””â”€â”€ [id]/               # ìº í˜ì¸ ìƒì„¸ (CSR + React Query)
â”‚   â””â”€â”€ creator/
â”‚       â””â”€â”€ my-campaigns/       # ë‚´ ìº í˜ì¸ ëª©ë¡ (CSR + React Query)
â”œâ”€â”€ auth/                # ì¸ì¦ ê´€ë ¨
â”‚   â”œâ”€â”€ login/
â”‚   â”œâ”€â”€ register/
â”‚   â””â”€â”€ select-role/
â””â”€â”€ cl/                   # íŠ¸ë˜í‚¹ ë§í¬ (ì„œë²„ ë¼ìš°íŠ¸)
    â””â”€â”€ [campaignId]/[creatorId]/
```

### 3.2 API ë¼ìš°íŠ¸

```
app/api/
â””â”€â”€ advertiser/
    â””â”€â”€ campaigns/
        â””â”€â”€ [id]/
            â”œâ”€â”€ creators/       # í¬ë¦¬ì—ì´í„° ëª©ë¡ ì¡°íšŒ
            â””â”€â”€ stats/          # ìº í˜ì¸ í†µê³„
```

### 3.3 ì„œë²„ ì•¡ì…˜

- `app/actions.ts`: ì„œë²„ ì‚¬ì´ë“œ ì•¡ì…˜ (ë¡œê·¸ì•„ì›ƒ ë“±)

---

## 4. ë°ì´í„° íë¦„

### 4.1 ì¸ì¦ íë¦„

```
1. ì‚¬ìš©ì ë¡œê·¸ì¸
   â†“
2. Supabase Auth (JWT ë°œê¸‰)
   â†“
3. Middlewareì—ì„œ ì„¸ì…˜ í™•ì¸
   â†“
4. Role ê¸°ë°˜ ë¼ìš°íŒ…
   - creator â†’ /campaigns
   - advertiser â†’ /advertiser/dashboard
```

### 4.2 ìº í˜ì¸ ë°ì´í„° íë¦„

**ìº í˜ì¸ íƒìƒ‰ (CSR)**
```
CampaignList (Client Component)
  â†“
useCampaigns() Hook
  â†“
React Query Cache
  â†“
Supabase Client Query
  â†“
PostgreSQL Database
```

**ìº í˜ì¸ ìƒì„¸ (CSR)**
```
CampaignDetailPage (Client Component)
  â†“
useCampaignDetail() Hook
  â†“
React Query Cache
  â†“
Supabase Client Query
```

**ê´‘ê³ ì£¼ ëŒ€ì‹œë³´ë“œ (CSR)**
```
AdvertiserDashboardContent (Client Component)
  â†“
useUserProfile() + useAdvertiserCampaigns() + useAdvertiserPendingApplications()
  â†“
React Query Cache
  â†“
Supabase Client Query
  â†“
PostgreSQL Database
  â†“
ë°ì´í„° ë°˜í™˜ ë° ìºì‹±
```

**ê´‘ê³ ì£¼ ìº í˜ì¸ ìƒì„¸ (CSR)**
```
CampaignDetailContent (Client Component)
  â†“
useCampaignDetail(id, user, includeInactive=true)
  â†“
React Query Cache
  â†“
Supabase Client Query
  â†“
PostgreSQL Database
  â†“
ë°ì´í„° ë°˜í™˜ ë° ìºì‹±
```

### 4.3 íŠ¸ë˜í‚¹ ë§í¬ íë¦„

```
/cl/[campaignId]/[creatorId]
  â†“
ì„œë²„ ë¼ìš°íŠ¸ (GET)
  â†“
1. ìº í˜ì¸ ì¡°íšŒ
2. í´ë¦­ ë¡œê·¸ ê¸°ë¡ (clicks í…Œì´ë¸”)
3. target_urlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
```

---

## 5. ìƒíƒœ ê´€ë¦¬

### 5.1 ì„œë²„ ìƒíƒœ (React Query)

- **ìº í˜ì¸ ë°ì´í„°**: `useCampaigns`, `useCampaignDetail`
- **ì‚¬ìš©ì ì •ë³´**: `useUser`, `useUserProfile`
- **ì¹´í…Œê³ ë¦¬**: `useCategories`, `useAllCategories`
- **í†µê³„**: `useDashboardStats` (í†µí•©ë¨, `useCampaignClickCounts`ëŠ” deprecated)
- **ê´‘ê³ ì£¼**: `useAdvertiserCampaigns`, `useAdvertiserPendingApplications`

### 5.2 í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ

- **ë¡œì»¬ UI ìƒíƒœ**: `useState` (ë¡œë”©, í¼ ì…ë ¥ ë“±)
- **ë¼ìš°íŒ… ìƒíƒœ**: Next.js `useRouter`, `useSearchParams`

---

## 6. ë³´ì•ˆ ë° ì¸ê°€

### 6.1 Middleware ê¸°ë°˜ ì¸ì¦

- ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ Supabase ì„¸ì…˜ í™•ì¸
- ê³µìš© ê²½ë¡œì™€ ë³´í˜¸ëœ ê²½ë¡œ êµ¬ë¶„
- Role ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)

### 6.2 ë°ì´í„° ë§ˆìŠ¤í‚¹

- ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì: ê°€ê²© ì •ë³´, ë³´ìƒ ê¸ˆì•¡ ë§ˆìŠ¤í‚¹
- `useCampaigns` í›…ì—ì„œ ìë™ ì²˜ë¦¬
- í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì¶”ê°€ ë§ˆìŠ¤í‚¹ (`LockedValue` ì»´í¬ë„ŒíŠ¸)

---

## 7. ì„±ëŠ¥ ìµœì í™”

### 7.1 React Query ìºì‹±

- `staleTime`: 30ì´ˆ (ìº í˜ì¸), 60ë¶„ (ì¹´í…Œê³ ë¦¬)
- `refetchOnWindowFocus`: false
- ì¿¼ë¦¬ í‚¤ì— ì‚¬ìš©ì ID í¬í•¨ìœ¼ë¡œ ì‚¬ìš©ìë³„ ìºì‹œ ë¶„ë¦¬

### 7.2 ì½”ë“œ ë¶„í• 

- Next.js App Router ìë™ ì½”ë“œ ë¶„í• 
- ë™ì  import í•„ìš” ì‹œ ì ìš© ê°€ëŠ¥

### 7.3 ì´ë¯¸ì§€ ìµœì í™”

- `ImageWithFallback` ì»´í¬ë„ŒíŠ¸ë¡œ fallback ì²˜ë¦¬
- Next.js Image ì»´í¬ë„ŒíŠ¸ í™œìš© ê°€ëŠ¥ (í–¥í›„)

### 7.4 ë°ì´í„° í˜ì¹­ ì „ëµ

**í˜„ì¬ êµ¬ì¡°:**
- í¬ë¦¬ì—ì´í„° í˜ì´ì§€: ì™„ì „ CSR (React Query)
- ê´‘ê³ ì£¼ í˜ì´ì§€: SSR (ì´ˆê¸° ë°ì´í„°) + CSR (í†µê³„)

**í–¥í›„ ê°œì„  ë°©í–¥:**
- ê´‘ê³ ì£¼ í˜ì´ì§€ë„ CSRë¡œ í†µí•© ê²€í† 
- React Query ìºì‹±ìœ¼ë¡œ ì´ˆê¸° ë¡œë“œ ì„±ëŠ¥ ê°œì„  ê°€ëŠ¥
- ì¼ê´€ëœ ë°ì´í„° í˜ì¹­ íŒ¨í„´ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

---

## 8. ì£¼ìš” ê¸°ëŠ¥ ëª¨ë“ˆ

### 8.1 ìº í˜ì¸ ê´€ë¦¬

**ê´‘ê³ ì£¼**
- ìº í˜ì¸ ìƒì„±/ìˆ˜ì •
- í¬ë¦¬ì—ì´í„° ì§€ì› ìŠ¹ì¸/ê±°ì ˆ
- ì„±ê³¼ ëŒ€ì‹œë³´ë“œ

**í¬ë¦¬ì—ì´í„°**
- ìº í˜ì¸ íƒìƒ‰ ë° í•„í„°ë§
- ìº í˜ì¸ ì§€ì›
- ë‚´ ìº í˜ì¸ ê´€ë¦¬

### 8.2 ë§ˆì´ìƒµ

- í¬ë¦¬ì—ì´í„°ë³„ ê³ ìœ  URL
- ì œí’ˆ ì§„ì—´
- íŠ¸ë˜í‚¹ ë§í¬ ìƒì„±
- í´ë¦­ í†µê³„

### 8.3 ëŒ€ì‹œë³´ë“œ

**ê´‘ê³ ì£¼**
- ìº í˜ì¸ë³„ í†µê³„
- í¬ë¦¬ì—ì´í„°ë³„ ì„±ê³¼
- í´ë¦­ ìˆ˜ ì§‘ê³„

**í¬ë¦¬ì—ì´í„°**
- ë‚´ ìº í˜ì¸ ëª©ë¡
- í´ë¦­ ìˆ˜ í™•ì¸
- íŠ¸ë˜í‚¹ ë§í¬ ê´€ë¦¬

---

## 9. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (ì¶”ì •)

### ì£¼ìš” í…Œì´ë¸”

- `profiles`: ì‚¬ìš©ì í”„ë¡œí•„ ë° ì—­í•  (nickname í¬í•¨)
- `campaigns`: ìº í˜ì¸ ì •ë³´
- `products`: ì œí’ˆ ì •ë³´
- `product_categories`: ì œí’ˆ ì¹´í…Œê³ ë¦¬ (ê³„ì¸µ êµ¬ì¡°)
- `campaign_applications`: í¬ë¦¬ì—ì´í„° ì§€ì› ë‚´ì—­
- `clicks`: í´ë¦­ íŠ¸ë˜í‚¹ ë¡œê·¸
- `orders`: ì£¼ë¬¸ ì •ë³´ (í–¥í›„)

---

## 10. í–¥í›„ ê°œì„  ì‚¬í•­

### ì•„í‚¤í…ì²˜

- [x] âœ… ê´‘ê³ ì£¼ í˜ì´ì§€ CSR ì „í™˜ ì™„ë£Œ
- [x] âœ… ë°ì´í„° í˜ì¹­ íŒ¨í„´ í†µì¼ (CSR + React Query)
- [ ] Next.js Image ì»´í¬ë„ŒíŠ¸ ë„ì…
- [ ] API ë¼ìš°íŠ¸ í†µí•© ë° í‘œì¤€í™”
- [ ] ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ì¶”ê°€

### ì„±ëŠ¥

- [x] âœ… ì¤‘ë³µ ì¿¼ë¦¬ í†µí•© ì™„ë£Œ
- [x] âœ… React Query ìºì‹± ìµœì í™” ì™„ë£Œ
- [x] âœ… ìŠ¤ì¼ˆë ˆí†¤ UI ì ìš© ì™„ë£Œ
- [ ] ì´ë¯¸ì§€ ìµœì í™” (WebP, lazy loading)
- [ ] ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… ìµœì í™”
- [ ] React Query prefetching ì „ëµ

### ê°œë°œ ê²½í—˜

- [x] âœ… ê³µí†µ ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ (CategoryText, Skeleton ë“±)
- [x] âœ… íƒ€ì… ì‹œìŠ¤í…œ ì •ë¦¬ (lib/types/)
- [ ] í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€
- [ ] Storybook ë„ì…

---

## 11. ì˜ì¡´ì„± ê´€ê³„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Next.js App Router              â”‚
â”‚  (Pages, API Routes, Middleware)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚   SSR       â”‚  â”‚    CSR       â”‚
â”‚ Components  â”‚  â”‚ Components   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  React Query   â”‚
       â”‚  (TanStack)    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Supabase      â”‚
       â”‚  (Client/      â”‚
       â”‚   Server)      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  PostgreSQL   â”‚
       â”‚  Database     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. ì»´í¬ë„ŒíŠ¸ ê³„ì¸µ êµ¬ì¡°

```
RootLayout
â”œâ”€â”€ QueryProvider (React Query)
â”œâ”€â”€ Header (ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜)
â””â”€â”€ Page Components
    â”œâ”€â”€ Server Components
    â”‚   â””â”€â”€ AdvertiserDashboard
    â””â”€â”€ Client Components
        â”œâ”€â”€ CampaignList
        â”œâ”€â”€ CampaignDetailForCreator
        â””â”€â”€ MyCampaignsList
            â””â”€â”€ MyCampaignListItem
```

---

**ë¬¸ì„œ ë²„ì „**: 1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-18

